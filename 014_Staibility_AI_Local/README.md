# 画像スタイル変換スクリプト for Stable Diffusion Web UI

## 概要

このPythonスクリプトは、ローカル環境で動作しているStable Diffusion Web UIのAPIを利用して、指定した画像ファイルを様々な画風（例: 水彩画風、ドラゴンボール風など）に変換します。ユーザーは対話形式で変換したい画像、適用したいスタイル、関連するプロンプトなどを指定できます。

## 機能

-   ローカルに保存されている画像ファイルを読み込みます。
-   適用したい画風を複数の選択肢から選べます。
    -   水彩画風
    -   ドラゴンボール風 (対応するLoRAモデルが必要)
-   スタイルに応じて、基本的なプロンプトやimg2img処理のパラメータ（Denoising Strengthなど）を適用します。
-   ユーザーが追加のプロンプト（被写体の説明など）を入力できます。
-   ドラゴンボール風スタイルでは、使用するLoRAモデルのファイル名とトリガーワードをユーザーが指定できます。
-   変換後の画像を指定されたディレクトリに保存します。

## 必要なもの (Prerequisites)

-   **Python:** 3.8以上 (スクリプト開発時はPython 3.10.6で動作確認)
-   **Stable Diffusion Web UI:** [AUTOMATIC1111版](https://github.com/AUTOMATIC1111/stable-diffusion-webui) などのAPI機能を持つWeb UIがローカルマシンにインストールされ、正常に動作していること。
-   **Web UIのAPI有効化:** Stable Diffusion Web UIが `--api` コマンドライン引数付きで起動されていること。
-   **必要なPythonライブラリ:**
    -   `requests` (API通信用)
    -   `Pillow` (画像処理用)
-   **(オプション) LoRAモデル:** 特定の画風（例: ドラゴンボール風）を高品質に再現するためには、対応するLoRAモデルが必要です。LoRAモデルは、Stable Diffusion Web UIの `models/Lora` ディレクトリに配置してください。

## セットアップ (Setup)

1.  **スクリプトのダウンロード:**
    ```bash
    git clone [あなたのリポジトリURL]
    cd [リポジトリ名]
    ```
    または、このプロジェクトのスクリプトファイル（例: `image_converter.py`）を直接ダウンロードしてください。

2.  **Python仮想環境の作成と有効化 (強く推奨):**
    プロジェクトディレクトリのルートで以下のコマンドを実行します。
    ```bash
    python -m venv venv
    ```
    仮想環境を有効化します:
    -   Windows (PowerShell):
        ```powershell
        .\venv\Scripts\Activate.ps1
        ```
        (実行ポリシーのエラーが出る場合は `Set-ExecutionPolicy RemoteSigned -Scope Process` を試してください)
    -   Windows (コマンドプロンプト):
        ```bash
        .\venv\Scripts\activate.bat
        ```
    -   macOS / Linux:
        ```bash
        source venv/bin/activate
        ```

3.  **必要なライブラリのインストール:**
    仮想環境が有効化された状態で、以下のコマンドを実行します。
    ```bash
    pip install requests Pillow
    ```
    (もし `requirements.txt` ファイルがあれば、`pip install -r requirements.txt` で一括インストールできます。)

## 使い方 (Usage)

1.  **Stable Diffusion Web UIの起動:**
    お使いのStable Diffusion Web UIを `--api` オプションを付けて起動してください。起動時にターミナルに表示されるURLとポート番号（例: `http://127.0.0.1:7861`）を控えておきます。

2.  **スクリプトの設定確認 (必要な場合):**
    スクリプトファイル（例: `image_converter.py`）を開き、以下の定数がご自身の環境と合っているか確認・編集してください。
    ```python
    API_URL = "[http://127.0.0.1:7861](http://127.0.0.1:7861)"  # Web UIのURLとポート番号
    OUTPUT_DIR = "converted_images"    # 生成画像の保存先フォルダ名
    ```

3.  **スクリプトの実行:**
    ターミナルで以下のコマンドを実行します。
    ```bash
    python image_converter.py
    ```
    (スクリプトのファイル名に合わせてください)

4.  **対話形式での入力:**
    スクリプトが起動すると、以下の情報を順番に尋ねられますので、指示に従って入力してください。
    -   変換したい写真のフルパス
    -   変換するスタイルの選択（番号で選択）
    -   選択したスタイルに応じた追加のプロンプト（被写体の説明など）
    -   (ドラゴンボール風の場合) LoRAファイル名、トリガーワード
    -   Denoising Strengthの値（0.0～1.0）

5.  **結果の確認:**
    処理が完了すると、指定した出力ディレクトリ（デフォルトでは `converted_images` フォルダがスクリプトと同じ階層に作成されます）に、変換後の画像が保存されます。ファイル名は元のファイル名と適用したスタイルに基づいて自動生成されます。

## 注意点

-   本スクリプトを実行する前に、Stable Diffusion Web UIが起動しており、API機能が有効になっていることを必ず確認してください。
-   Web UIのポート番号がスクリプト内の `API_URL` と一致しているか確認してください。デフォルトは `7860` ですが、環境によっては `7861` など他のポートで起動することがあります。
-   「ドラゴンボール風」のような特定のスタイルで高品質な結果を得るには、適切なLoRAモデルを事前に `models/Lora` ディレクトリに準備し、スクリプト実行時に正しいLoRAファイル名とトリガーワードを指定する必要があります。
-   入力する画像の解像度が高い場合や、ステップ数が多い設定の場合、処理に時間がかかったり、多くのVRAM（GPUメモリ）を消費する可能性があります。
-   エラーが発生した場合は、Stable Diffusion Web UIのコンソール（`webui-user.bat`などを実行したウィンドウ）に表示されるエラーメッセージも確認してください。

## 今後の展望 (例)

-   GUI（グラフィカルユーザーインターフェース）の追加（例: Tkinter, PySimpleGUI, Streamlit, Gradioなどを使用）
-   対応スタイルの拡充と、各スタイルごとの詳細なプリセット設定機能
-   より多くの画像生成パラメータを対話的に設定できるオプションの追加
-   指定したフォルダ内の複数画像を一度に処理するバッチ処理機能
-   生成画像のプレビュー機能

## ライセンス

このプロジェクトは [MIT License] の下で公開されています。

---

**`requirements.txt` の作成のおすすめ:**

GitHubにアップロードする際には、プロジェクトのルートディレクトリに `requirements.txt` というファイル名で以下の内容を記述したファイルを含めることをお勧めします。これにより、他の人が `pip install -r requirements.txt` コマンドで簡単に必要なライブラリをインストールできるようになります。