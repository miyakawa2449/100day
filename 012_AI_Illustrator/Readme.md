# AI Illustrator (100日チャレンジ 12日目)

## 概要

このプロジェクトは、100日チャレンジの一環として、写真からイラストを生成するAIプログラムを作成することを目標としています。
現在は、Stability AI API を利用して画像生成機能を実装中です。

## 現在の状況 (2025-05-11時点)

* Pythonスクリプト (`stability_test.py`) を使用して、Stability AI API (`stability-sdk`) 経由での画像生成を試みています。
* `init_image` を使用した画像から画像への変換 (Image-to-Image) および、テキストのみからの画像生成 (Text-to-Image) の両方をテストしました。
* シンプルなプロンプト（例: "A cute cat drawn in high quality anime style."）を使用し、`init_image` なしで実行した場合でも、APIレスポンスにおいて `Finish Reason: NULL (raw value: 0)` となり、コンテンツフィルターによって画像がブロックされている状況です。
    * APIから返却される分類情報 (JSON) では、プロンプトおよび（潜在的な）出力画像は "SAFE" と判定されています。
* Stability AI のアカウントページで確認した限りでは、APIキーやクレジット残高には問題は見られませんでした。
* 以前、サンプラー指定時に `ValueError: unknown enum label "K_DPMPP_2M"` が発生したため、現在はSDKのデフォルトサンプラーを使用しています。

## 使用技術

* Python 3.11
* Stability AI API (`stability-sdk`)
* Pillow (PIL)
* python-dotenv

## セットアップ方法

### 準備

1.  このリポジトリをクローンまたはダウンロードします。
2.  変換したい画像ファイル `your_photo.jpg` をプロジェクトのルートディレクトリに配置します（Image-to-Image機能を試す場合）。
3.  `.env.example` ファイルを参考に、プロジェクトのルートディレクトリに `.env` ファイルを作成し、ご自身のStability AI APIキーを設定します。
    ```env
    STABILITY_API_KEY="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    ```

### 環境構築 (仮想環境を推奨)

1.  プロジェクトのルートディレクトリでターミナルを開き、仮想環境を作成します。
    ```bash
    python -m venv venv
    ```
2.  仮想環境を有効化します。
    * Windows (PowerShell):
        ```powershell
        .\venv\Scripts\Activate.ps1
        ```
    * macOS/Linux:
        ```bash
        source venv/bin/activate
        ```
3.  必要なライブラリをインストールします。
    ```bash
    pip install stability-sdk Pillow python-dotenv
    ```
    (将来的には `requirements.txt` を作成予定)

### 実行

以下のコマンドでスクリプトを実行します。
```bash
python stability_test.py

## 現在のコード

主要な処理は `stability_test.py` に記述されています。
このスクリプトは、Stability AI API への接続、画像の前処理（Image-to-Imageの場合）、APIへのリクエスト送信、および返ってきたレスポンス（アーティファクト情報、フィルター結果など）の詳細なログ出力機能を含んでいます。

現在のバージョンでは、コンテンツフィルターによって画像生成がブロックされる問題の原因を特定するために、詳細なデバッグ情報が出力されるようになっています。

## 今後の課題・作業予定

### 2025年5月12日 (月) 以降のタスク

-   **[最優先] コンテンツフィルター問題の解決**
    -   [ ] **プロンプトの極端な単純化テスト**: `"red square"` のような、スタイルや生物を含まない完全に無機質なプロンプトで画像が生成されるか最終確認する。
    -   [ ] **時間を置いて再試行**: 新規アカウント/APIキーへの一時的な強いフィルタリングポリシーである可能性を考慮し、数時間後または翌日に再度テストを行う。
    -   [ ] **Stability AI 公式ドキュメント/コミュニティでの情報収集**: コンテンツフィルタリングポリシー、APIの利用制限（特に新規アカウント向け）、同様の現象に関する他のユーザーの報告などを調査する。
    -   [ ] **(上記で解決しない場合) Stability AI サポートへの問い合わせ**: 現在の状況（試したこと、シンプルなプロンプトでもブロックされること、`Finish Reason: NULL (0)` となること、分類JSONの内容など）をまとめて問い合わせる準備をする。

-   **(フィルター問題解決後) サンプラーの再検討と適用**
    -   [ ] `stability-sdk` バージョン 0.8.6 で有効なサンプラー名とその正しい指定方法を公式ドキュメント等で正確に調査する（以前 `ValueError: unknown enum label "K_DPMPP_2M"` が発生したため）。
    -   [ ] いくつかの有効なサンプラーを試し、画質やスタイルへの影響を確認する。

-   **(フィルター問題解決後) Image-to-Image 機能の再実装とテスト**
    -   [ ] 再度 `init_image` パラメータを使用して、写真 (`your_photo.jpg`) からのイラスト生成に挑戦する。
    -   [ ] `start_schedule` などの関連パラメータを調整し、元画像とプロンプトの指示のバランスを最適化する。
    -   [ ] 異なる種類の入力画像でテストし、フィルターへの感受性や画風変換の品質を確認する。

-   **UIの検討・実装**
    -   [ ] Gradio または Streamlit を用いた簡単なWeb UIの作成を検討する。目標は、画像アップロード機能、プロンプト入力フィールド、主要なパラメータ調整スライダー、生成結果の表示エリアなどを持つこと。

-   **機能拡張のアイデア**
    -   [ ] 複数の定義済み画風（アニメ調、水彩画調、油絵調など）を選択できる機能。
    -   [ ] 生成パラメータ（ステップ数、CFGスケール、画像サイズなど）をUIからより細かく調整できる機能。
    -   [ ] 生成されたイラストの簡単な編集機能（トリミング、明るさ調整など）の追加検討。

-   **その他**
    -   [ ] `requirements.txt` を作成し、プロジェクトの依存関係を明確にする。
    -   [ ] コードのリファクタリングを行い、可読性やメンテナンス性を向上させる。
    -   [ ] エラーハンドリングをより堅牢にする。

## (オプション) コントリビューション

現時点では個人の100日チャレンジプロジェクトですが、将来的にもし公開し、改善のアイデアやバグ報告などがあれば歓迎します。

## (オプション) ライセンス

このプロジェクトはMITライセンスの下で公開されています。